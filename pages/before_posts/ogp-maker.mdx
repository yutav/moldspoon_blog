import { Layout } from 'lib/components'
import { Button } from '@geist-ui/core'
import TagLinks from "../../lib/components/original/parts/TagLinks"

import { useRouter } from 'next/router'

import MdxImage from "../../lib/components/original/parts/MdxImage"

export const meta = {
  title: 'ブログのOGP画像メーカーをNext.jsでつくる',
  date: '2023-08-07T09:00:00.000Z',
  tags: [
    'Blog',
    'Next.js',
    'プログラミング',
    'OGP画像メーカー',
    'OGP画像',
  ]
}

こんにちは、[yuku_tas](https://twitter.com/yuku_tas)です。

### 本記事のゴール

ブログのOGP画像メーカーをサクッと作る

### 作業

暑い日が続いてますね、クーラーにもやられないよう体調に気をつけて楽しいプログラミングライフを送りたいなと思います...

さて、今日はブログの各記事に貼り付けるOGP画像メーカーを弊社の[Spoon Tools!](https://moldspoon.jp/tools)に作る過程をまとめます。
参考になればと思います。

#### 要求仕様

複雑なものではないので、箇条書きして整理します。

##### いま必要

- OGP画像タイトルをテキストで指定
- 背景画像を数パターンから選べる
- 1500x945ピクセルの画像が、作成完了後即時ダウンロードされる

##### 将来的にいるかも
- 背景画像をアップロードできる。
- 複数の画像から選択できる。

将来的に拡張も視野に設計します。

#### 設計

これは既に土台となるプロジェクトが[できている](https://moldspoon.jp/tools)ので比較的簡単です。

1. フロントエンドでフォームのあるページを作り
2. バックエンドで画像加工処理を行い、
3. ブラウザからダウンロードさせるだけ。

#### フィジビリティスタディ (技術検討)

以前にPHPプロジェクトで**ImageMagick**を使って画像作成を行ったことを思い出したので
「ImageMagick Next.js」とかで検索すると以下の記事がヒットしました。

[Cloud Functions で ImageMagick 使って OGP 画像を生成・表示する](https://ema-hiro.hatenablog.com/entry/2023/07/23/235530)

なるほど、**Cloudに任せちゃうのはアリ**だなと。
他に、以下もヒット。

[ImageMagickをやめて画像の処理はSaaSに頼ることにした](https://zenn.dev/catnose99/scraps/79e4807510b9db)
こちらは有名なzenn.devの開発者catnoseさんのzenn内でのポストですね。
やっぱり画像合成処理は自前でバックエンドを用意してImageMagickで頑張るより、外注するのがアイデアとしては筋が良さそう。

ただ、ポスト内で勧められているさくらインターネットさんの[Image Flux](https://imageflux.sakura.ad.jp/)は利用料金がちょっと高い（と言っても月額550円ですが。。。）
そのため個人に近い弊社では利用が難しいですね...。そもそもクラウドに投げるのは、利用用途が違うかも（ある程度スケールしたサービスでのトラフィックを考慮した外注処理かも）と思い始めてきました。

改めて先述のCloud Functionsで〜の記事を見返していると、Next.jsの公式ドキュメントへのリンクが。
[ImageResponse](https://nextjs.org/docs/app/api-reference/functions/image-response)
これ、いい。使おう。となりました。

### 開発作業

具体的に開発に入っていきます。

まずフロントエンドのページから用意します。



### まとめ

ドキュメントに当たるのはとても重要ですが、先に動かしてみた方が答えが出ることもあります。
最も今回は弊社のコーポレートサイトという比較的優先順位が低いものの設定だから許されることであり、
**クライアント様のDNS設定の場合は軽はずみに動かせないでしょう。**

何か別のドメインでテスト的に実行して挙動の確証を得るか、プロジェクト or 社内にいるDNS詳しい人に聞く、といったアクションが求められると思いました。

この記事が何かのお役に立てれば幸いです。
最後までお読みいただきありがとうございました！

export default function Page({ children }) {
  return (
    <Layout meta={meta}>
      <>
        {children}
      </>
    </Layout>
  )
}
